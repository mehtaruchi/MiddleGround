<!DOCTYPE html>

<head>
    <link rel="stylesheet" href="../static/dynamic.css">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        #map{height:80%;}
    </style>

    <script type="text/javascript" src="../static/add_remove.js"></script>


    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCd3yT-00TDYD1gYM6WWWKTO6kxOVr-ho8&libraries=places&callback=initAutocomplete"
        async defer></script>

<body>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

    <div class="card border-secondary mb-3" style="max-width: 18rem;" style="align-items: center;">
        <div class="card-header"><b>Add People</b></div>
        <div class="container" style="align-items: center;">
            <div class="row">
                <div class="control-group" id="fields">
                    <label class="control-label" for="field1">Enter Locations</label>
                    
                    <div class="controls">
                    <form role="form" method="POST" action="">
                    <fieldset class="form-group">
                        
                            <div class="entry input-group col-xs-3 form-group">
                                
                                {{ form.address1(class="form-control form-control-lg", id="autocomplete" , placeholder="Enter location") }}

                                        <div class="form-group">
                                                 {{ form.new_user(class="btn-succ btn-add") }}
                                        </div>
                            </div>

                        
                        <div class="form-group">
                                {{ form.final_submit(class="btn btn-outline-info") }}
                        </div>

                        <input type="hidden" name="hide_f" id="hide_i" >

                    </fieldset>    
                    </form>    
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="map"></div>




        <script>
        

        var placeSearch, autocomplete;
        var input_loc;

                function initMap() {
                var myGeocode = {{ data|tojson }};
                console.log('hellooooooo')
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: {lat: {{myGeocode.mid_lat}}, lng: {{myGeocode.mid_long}}}
        });
        var geocoder = new google.maps.Geocoder();
        console.log('hellooooooo')
        document.getElementById('final_submit').addEventListener('click', function() {
          geocodeAddress(geocoder, map);
        });
      }
        initMap();
      function geocodeAddress(geocoder, resultsMap) {
        console.log('Entered here')
        var address = document.getElementById('address').value;
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
              map: resultsMap,
              position: results[0].geometry.location
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }


        function initAutocomplete() {
            // Create the autocomplete object, restricting the search predictions to
            // geographical location types.
            

           
            //do something with each element
            autocomplete = new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{types: ['geocode']});
                    
            

            // Avoid paying for myGeocode that you don't need by restricting the set of
            // place fields that are returned to just the address components.
            autocomplete.setFields(['address_component']);
        }
    

        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                var geolocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                var circle = new google.maps.Circle(
                    {center: geolocation, radius: position.coords.accuracy});
                    autocomplete.setBounds(circle.getBounds());
                });
            }
        }
        </script>



</body>

</html>
